{% extends 'main.html' %}
<!-- Extend main.html -->

{% block content %}
<div class="container mx-auto mt-8">
    <h1 class="text-4xl font-bold mb-6">Gudang</h1>
    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold">Inventaris</h1>
            <button id="viewToggle"
                class="bg-gray-200 text-gray-700 rounded-md py-2 px-4 text-sm font-semibold transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 flex items-center space-x-2 hover:bg-gray-300 hover:shadow-md hover:scale-105 transform">
                <span id="toggleText" class="hover:text-gray-900">Tampilkan Sepeda</span>
                <svg xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5 transition-transform duration-300 ease-in-out hover:rotate-180" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                </svg>
            </button>
        </div>
        <div class="overflow-x-auto shadow-md text-xs mb-5 rounded-lg">
            <table id="partsTable" class="w-full border-collapse">
                <thead>
                    <tr class="bg-gray-100 text-gray-600">
                        <th class="text-left py-3 px-4 font-semibold border-b">ID Produk</th>
                        <th class="text-left py-3 px-4 font-semibold border-b">Nama Produk</th>
                        <th class="text-left py-3 px-4 font-semibold border-b">Stock</th>
                    </tr>
                </thead>
                <tbody class="bg-white">
                    {% for item in stock_data %}
                    <tr>
                        <td class="py-3 px-4 border-b">{{ item.id_produk }}</td>
                        <td class="py-3 px-4 border-b">{{ item.nama_produk }}</td>
                        <td class="py-3 px-4 border-b">{{ item.stock }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <table id="bikeTable" class="w-full border-collapse hidden">
                <thead>
                    <tr class="bg-gray-100 text-gray-600">
                        <th class="text-left py-3 px-4 font-semibold border-b">Sepeda Ontel</th>
                        <th class="text-left py-3 px-4 font-semibold border-b">Jumlah</th>
                    </tr>
                </thead>
                <tbody class="bg-white">
                    <tr>
                        <td class="py-3 px-4 border-b">Sepeda Ontel A</td>
                        <td class="py-3 px-4 border-b" id="bikeACount">0</td>
                    </tr>
                    <tr>
                        <td class="py-3 px-4 border-b">Sepeda Ontel B</td>
                        <td class="py-3 px-4 border-b" id="bikeBCount">0</td>
                    </tr>
                    <tr>
                        <td class="py-3 px-4 border-b">Sepeda Ontel C</td>
                        <td class="py-3 px-4 border-b" id="bikeCCount">0</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const viewToggle = document.getElementById('viewToggle');
        const toggleText = document.getElementById('toggleText');
        const partsTable = document.getElementById('partsTable');
        const bikeTable = document.getElementById('bikeTable');
        let showingBikes = false;

        viewToggle.addEventListener('click', function () {
            showingBikes = !showingBikes;
            if (showingBikes) {
                partsTable.classList.add('hidden');
                bikeTable.classList.remove('hidden');
                toggleText.textContent = 'Tampilkan Part';
                calculateBikes();
            } else {
                partsTable.classList.remove('hidden');
                bikeTable.classList.add('hidden');
                toggleText.textContent = 'Tampilkan Sepeda';
            }
        });

        function calculateBikes() {
            const parts = {
                'Roda A': 0,
                'Frame A': 0,
                'Stang A': 0,
                'Roda B': 0,
                'Frame B': 0,
                'Stang B': 0,
                'Roda C': 0,
                'Frame C': 0,
                'Stang C': 0
            };

            document.querySelectorAll('#partsTable tbody tr').forEach(row => {
                const name = row.cells[1].textContent;
                const stock = parseInt(row.cells[2].textContent);
                if (parts.hasOwnProperty(name)) {
                    parts[name] = stock;
                }
            });

            const bikeACount = Math.min(
                Math.floor(parts['Roda A']),
                parts['Frame A'],
                parts['Stang A']
            );
            const bikeBCount = Math.min(
                Math.floor(parts['Roda B']),
                parts['Frame B'],
                parts['Stang B']
            );
            const bikeCCount = Math.min(
                Math.floor(parts['Roda C']),
                parts['Frame C'],
                parts['Stang C']
            );

            document.getElementById('bikeACount').textContent = bikeACount;
            document.getElementById('bikeBCount').textContent = bikeBCount;
            document.getElementById('bikeCCount').textContent = bikeCCount;
        }
    });
</script>

{% endblock %}