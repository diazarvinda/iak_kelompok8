{% extends 'main.html' %}
<!-- Extend main.html -->

{% block content %}
<div class="container mx-auto mt-8">
    <h1 class="text-5xl font-bold mb-6">Transaksi</h1>
    <div class="bg-white rounded-lg shadow-md p-6">
        <form id="transactionForm" method="POST" action="/save_transaction"
            onsubmit="event.preventDefault(); submitTransaction();">
            <!-- Ensure the action matches the route -->
            <div class="mb-4">
                <label for="item" class="block text-gray-700 text-sm font-bold mb-2">Barang:</label>
                <select id="item" name="item" required class="border border-gray-300 rounded-md p-2 w-full">
                    <option value="" disabled selected>Pilih Model</option>
                    <option value="Sepeda Ontel A">Sepeda Ontel A</option>
                    <option value="Sepeda Ontel B">Sepeda Ontel B</option>
                    <option value="Sepeda Ontel C">Sepeda Ontel C</option>
                </select>
            </div>
            <div class="mb-4">
                <label for="quantity" class="block text-gray-700 text-sm font-bold mb-2">Jumlah:</label>
                <input type="number" id="quantity" name="quantity" required
                    class="border border-gray-300 rounded-md p-2 w-full">
            </div>
            <div class="mb-4">
                <label for="price" class="block text-gray-700 text-sm font-bold mb-2">Harga:</label>
                <input type="number" id="price" name="price" required
                    class="border border-gray-300 rounded-md p-2 w-full">
            </div>
            <button type="submit"
                class="bg-[#40DDC1] text-white rounded-md p-2 text-sm hover:bg-[#33b89d] transition duration-300 ease-in-out">
                Simpan
            </button>
        </form>
    </div>

    <!-- Success Message Box -->
    <div id="successBox"
        class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-xl mt-5 w-full">
        <p id="successMessage"></p>
    </div>
</div>

<script type="module">
    // Import the necessary Firebase functions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyD2dBzwq2uiCnASi3PTruIKJ-nBVzlaMsc",
        authDomain: "iak-retail-kelompok-8.firebaseapp.com",
        databaseURL: "https://iak-retail-kelompok-8-default-rtdb.firebaseio.com", // Add your database URL
        projectId: "iak-retail-kelompok-8",
        storageBucket: "iak-retail-kelompok-8.appspot.com",
        messagingSenderId: "530693322081",
        appId: "1:530693322081:web:270153437034677ad10120",
        measurementId: "G-W6448PF8BE"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app); // Initialize Realtime Database

    // Define the submitTransaction function in the global scope
    window.submitTransaction = async function() {
        const item = document.getElementById('item').value;
        const quantity = parseInt(document.getElementById('quantity').value, 10); // Ensure quantity is an integer
        const price = parseFloat(document.getElementById('price').value); // Ensure price is a float

        try {
            const newTransactionRef = ref(database, 'transactions/' + Date.now()); // Create a reference for the new transaction
            await set(newTransactionRef, {
                item: item,
                quantity: quantity,
                price: price
            });

            // Show the success message box
            const successBox = document.getElementById('successBox');
            const successMessageElement = document.getElementById('successMessage');
            successMessageElement.textContent = "Data transaksi berhasil disimpan.";
            successBox.classList.remove('hidden'); // Show the success box

            // Reset the form after submission
            document.getElementById('transactionForm').reset();
        } catch (e) {
            console.error("Error adding document: ", e);
            alert("Terjadi kesalahan saat menyimpan data: " + e.message);
        }
    }
</script>
{% endblock %}