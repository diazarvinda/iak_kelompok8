{% extends 'main.html' %}

{% block content %}
<div class="container mx-auto mt-8">
    <h1 class="text-5xl font-bold mb-6">Pemesanan</h1>
    <div class="bg-white rounded-lg shadow-md p-6">
        {% if orders %}
        <table class="min-w-full bg-white">
            <thead>
                <tr>
                    <th
                        class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                        Order ID</th>
                    <th
                        class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                        Tanggal</th>
                    <th
                        class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                        Items</th>
                    <th
                        class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                        Distributor</th>
                    <th
                        class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                        Total Harga</th>
                    <th
                        class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                        Aksi</th>
                </tr>
            </thead>
            <tbody>
                {% for order_id, order in orders.items() %}
                <tr>
                    <td class="py-2 px-4 border-b border-gray-200">{{ order.order_id }}</td>
                    <td class="py-2 px-4 border-b border-gray-200">{{ order.date }}</td>
                    <td class="py-2 px-4 border-b border-gray-200">
                        {% for item in order.cart %}
                        {{ item.product }} ({{ item.quantity }})<br>
                        {% endfor %}
                    </td>
                    <td class="py-2 px-4 border-b border-gray-200">{{ order.distributor }}</td>
                    <td class="py-2 px-4 border-b border-gray-200">Rp {{ order.total_price|int }}</td>
                    <td class="py-2 px-4 border-b border-gray-200">
                        <button onclick="confirmOrder('{{ order_id }}')"
                            class="bg-green-500 text-white rounded-md p-2 hover:bg-green-600 transition duration-300 ease-in-out">
                            Konfirmasi Pemesanan
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="text-center text-gray-500">Tidak ada pemesanan saat ini.</p>
        {% endif %}
    </div>
</div>

<script>
    function confirmOrder(orderId) {
        if (confirm('Apakah Anda yakin ingin mengkonfirmasi pemesanan ini?')) {
            fetch('/api/confirm_order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        order_id: orderId
                    }),
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.message) {
                        alert(data.message);
                        location.reload(); // Reload the page to reflect the changes
                    } else {
                        alert('Error: ' + data.error);
                    }
                })
                .catch((error) => {
                    console.error('Error:', error);
                    alert('An error occurred while confirming the order: ' + error.message);
                });
        }
    }
</script>
{% endblock %}